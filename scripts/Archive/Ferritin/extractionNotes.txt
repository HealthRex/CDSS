select count(distinct pat_id)
from 
  stride_order_results as sor,
  stride_order_proc as sop
where 
  sor.order_proc_id = sop.order_proc_id and
  base_name = 'ferritin'

1153 of 16K patients with a ferritin result
=============================================

select patient_id
from patient_item
where clinical_item_id in (3614,4177,4220)

Most surgery patients
911 after excluding above
=============================================

where clinical_item_id in (3614,4177,4220,   1815,3783,4322)

Most surgery patients and any with Dialysis orders
810 after excluding all of above
=============================================


where clinical_item_id in (3614,4177,4220,   1815,3783,4322,  3648)
Most surgery patients and any with Dialysis orders and any receiving RBC transfusion
=============================================


select count(distinct pat_id)
from 
  stride_order_results as sor,
  stride_order_proc as sop
where 
  sor.order_proc_id = sop.order_proc_id and
  base_name = 'Cr' and
  ord_num_value > 2.5
  
1628 any with creatinine >2.5 (at any time, including acutely)
===============================================

select distinct pat_id
from 
  stride_order_results as sor,
  stride_order_proc as sop
where 
  sor.order_proc_id = sop.order_proc_id and
  base_name = 'ferritin' and
  pat_id not in
	( select patient_id
	  from patient_item
	  where clinical_item_id in (3614,4177,4220,   1815,3783,4322,  3648)
	)
490 patients	

Separate query to manually cut out below as takes long query time

select distinct pat_id
from 
  stride_order_results as sor,
  stride_order_proc as sop
where 
  sor.order_proc_id = sop.order_proc_id and
  base_name = 'Cr' and
  ord_num_value > 2.5

All Exclusions
431 patients meeting criteria
('2769067', '2876507', '896868', '3032614', '2803731', '2501548', '843247', '825673', '840943', '663916', '1300254', '1420477', '2733829', '1527610', '2769395', '480525', '1214698', '1764631', '2784251', '352720', '2525679', '1569465', '462352', '2569723', '1834304', '1865160', '277187', '2789654', '2773370', '3036765', '1386713', '2586279', '1175706', '2775098', '238206', '236469', '2722592', '1267308', '2964076', '581176', '2762625', '2789250', '2820699', '2563076', '192087', '435600', '1843055', '2576963', '2979260', '719114', '1110675', '683161', '2796010', '2968377', '1384162', '2770201', '2749656', '1058327', '1706654', '2437970', '762553', '2297369', '294311', '1653963', '208254', '433992', '2823247', '2764186', '844615', '966138', '2642528', '2811357', '1483798', '683892', '1273548', '2136029', '2032862', '1574605', '596446', '980765', '2769942', '2455343', '468080', '1428749', '2735309', '2824466', '203543', '2795300', '504032', '1843404', '2996974', '482426', '1851291', '779413', '2301635', '2697361', '2816861', '2711978', '887169', '2972766', '1071326', '321066', '744618', '2674761', '2768960', '3038867', '2804829', '2011550', '905686', '704408', '2197961', '2784018', '2780837', '2971322', '2631019', '172703', '1210907', '2572932', '3041068', '2820548', '2796596', '2994656', '1315328', '2810393', '2739248', '2799789', '462956', '407534', '3043265', '2775513', '2697412', '1099867', '1344887', '1838215', '2794124', '1607645', '3041413', '2984476', '3040830', '653915', '2798146', '2600497', '2761390', '2777732', '2445671', '2151726', '2448980', '2735224', '2823011', '2722697', '261023', '2785230', '2787487', '2786441', '3040901', '2525643', '149328', '366765', '2391885', '2967922', '1044911', '2767186', '2812208', '3031986', '3032800', '3039282', '2974397','2792406', '2318411', '2803218', '1416969', '2774954', '2663570', '2768076', '2124229', '1910621', '2749237', '2565917', '2768355', '2985813', '1232214', '2147482', '1005645', '2701584', '2781862', '503685', '2765976', '207981', '2822713', '2997413', '616224', '2774488', '2968927', '2960697', '870563', '2593900', '2987992', '421455', '2105941', '2981354', '2970743', '2714320', '2774193', '2737451', '655996', '251338', '2287322', '2653627', '2801967', '2159666', '2631757', '2047221', '500406', '3040598', '2702214', '1608170', '536246', '1093126', '2016818', '2805018', '494351', '2778366', '2798911', '398645', '2981831', '2396522', '141648', '1415515', '2792742', '366426', '367428', '1489918', '2779862', '815200', '2818096', '2737360', '2787225', '1082939', '2709978', '1369956', '2803758', '2801751', '2970702', '2764428', '2755040', '2765572', '2985236', '1742335', '493017', '1028788', '2331002', '1818056', '2997441', '2762979', '1820502', '2803110', '769990', '2806875', '2804785', '2988959', '2767626', '770811', '189005', '2970777', '3036627', '2253866', '2446832', '635533', '2980160', '1787103', '2812238', '864312', '962214', '2555483', '2215944', '2303681', '1707214', '438896', '826022', '2960345', '2616055', '2482218', '2817313', '2049603', '382715', '2491050', '1262468', '2819035', '2796137', '2796524', '1956533', '1326009', '2679993', '2815439', '463495', '2402762', '2795420', '1805453', '229951', '1060511', '842728', '1407156', '1445088', '2811482', '2786088', '2350463', '2793485', '2776269', '740042', '2823261', '203702', '672815', '1360633', '2982636', '2982739', '282558', '3036256', '2711621', '2991874', '881027', '1300643', '2731629', '2749808', '1614280', '2776169', '2650653', '624890', '2027822', '1677899', '873373', '1003991', '2638052', '2755189', '2805897', '2184419', '844784', '2782040', '2798900', '1935815', '1868462', '681209', '2251352', '2762738', '2805315', '2217254', '252094', '2968562', '1575155', '135451', '2583758', '2135273', '2762226', '2800172', '1380417', '1265364', '1436843', '2595133', '767470', '3039212', '2781231', '2480365', '2775893', '3032729', '2963749', '2964788', '1541233', '856618', '2454241', '2791486', '351261', '2970705', '2763105', '2694203', '2816117', '1647690', '3032438', '1917336', '2802568', '1579589', '2805693', '2802830', '2805696', '3036290', '299038', '2754713', '2745326', '3042146', '2981376', '2804709', '2688142', '2537575', '2916042', '1918413', '3031661', '821292', '2808132', '728596', '967644', '837261', '2162555', '3041120', '2287707', '2260464', '2781460', '1921151', '2296829', '2821673', '2787972', '2816017', '558039', '2559510', '3035166', '2495541', '2741630', '1611101', '3038847', '2798546', '2516780', '2631527', '3043098', '1687696', '1742772', '1397017', '2566767', '2965195', '2989368', '2292762', '1154275', '472255', '2810545', '2769649')
==============================================


