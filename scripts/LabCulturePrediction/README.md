# Table of Contents
- [Goal](#goal)
- [Background](#background)
   - [Motivation](#background-motivation)
   - [Terms](#background-terms)
- [Data](#data)
- [How tos](#howtos)
- [ML tasks](#mltasks)
- [Further Investigation](#further-investigation)
- [Suggested Readings](#readings)

# <a name="goal"></a>Goal

The goal of this project is to predict the result of blood culture lab results. As a corollary,
we also seek to predict the susceptibility/resistance of certain cultures to certain antibiotics.

# <a name="background"></a>Background
## <a name="background-motivation"></a>Motivation

Understanding accurate predictors of blood culture labs could help physicians choose the appropriate
spectrum antibiotic and help reduce the need to perform certain lab tests thereby reducing waste. 
Additionally, choosing the right spectrum antibiotic is becoming more imperative as bacteria start to 
develop resistance to broad spectrum antibiotics.

## <a name="background-terms"></a>Terms

### Blood culture
A test of a blood sample to find organisms that can cause infection.

### Antibiotic
A class of drugs that inhibit/destroys the growth of microorganisms. Examples you will encounter in this project include ciprofloxacin, amoxicillin, etc.

### Bacteria
Unicellular microorganisms known to cause diseases. Examples you will encounter in the data include Streptococcus pneumoniae, Escherichia coli.

### Bacteremia
Presence of bacteria in the blood.

### Antibiotic resistance
Change in bacteria to be less susceptible to antibiotics.


# <a name="data"></a>Data
The core data for this project is in the stride_culture_micro table. This table provides a series of blood
culture tests.
Note: we create a new column in our matrix for our presence/absence label  using
the organism_name column from stride_culture_micro. See LabCultureMatrix for code sample.

# <a name="howtos"></a>How tos
## Loading the data needed for this project
It is recommended that you load the data for this project from the data dumps. This is a much faster way to
have the data in your PSql DB as the dumps are already processed from the raw data.
- First download the dumps from our box folder at CDSS/Stride/data
- Run the script `stride/psql/dump_stride.sh`. Note: create a copy of this file and edit the appropriate env variables
You can now access the data via your psql server using command line or a desktop client such as PSequel.

## Running the project
There are two main files in this project:
1. LabCultureMatrix.py - creates a feature matrix for the analysis
2. LabCulturePredictionPipeline.py - performs analysis on the feature matrix generated by LabCultureMatrix

Run the appropriate script depending on which stage of the project you are working on.

## Adding features to feature matrix
The base feature matrix includes features such as vitals, blood pressure and blood cell counts out of the box.
For this project, LabCultureMatrix extends this class to include additional features we are interested in. 
For example, we add a column for absence/presence of bacteria.
See `_query_patient_episodes` method of LabCultureMatrix for an example of this.

## Choosing which lab panels
The call to LabCultureMatrix takes as an argument which lab panel you would like to build a matrix for. So far
we have only worked with LABBLC (aerobic blood culture). If running only LabCultureMatrix.py, you can change this
in the `main function` check.

## Performing analysis
The LabCulturePredictionPipeline.py file runs a series of training, testing and analysis on a feature matrix.
Its input is the output of LabCultureMatrix.py. Note: if you run LabCulturePredictionPipeline.py it will generate
a feature matrix using LabCultureMatrix and run analysis on this generated matrix.

Currently supported algorithms are:
- Decision Tree
- Logistic Regression
- Random Forest
- Regress and Round
- AdaBoost
- SVM
- Gaussian Naive Bayes

Output reports will be generated for each of these algorithms.


# <a name="mltasks"></a>ML Tasks
This project defines two main ML tasks.
1. Determine presence of infection
    * Binary classification
2. What strain of bacteria
    * Binary classification

Results of the above tasks are reproducible by running the current LabCulturePredictionPipeline script.


# <a name="further-investigation"></a>Further Investigation
This project could benefit from including additional features such as:

#### Adding previous medications as a feature
Previous medications of a patient could give us an indication of whether the patient has previously
grown a culture and serve as a proxy for the likelihood the patient will regrow the same culture.
Below is a list of antibiotics curated from interviews with domain experts that could serve as additional features:
   - cefepime
   - cefazolin
   - ceftriaxone
   - meropenem
   - piperacillin-tazobactam
   - vancomycin 
   - linezolid
   - daptomycin
   - levofloxacin
   - ciprofloxacin
   - ampicillin
   - metronidazole
   - tobramycin
   - caspofungin
   
Suggested implementation: We can treat each medication as a clinical item feature and include it in our
feature matrix. We can accomplish this via a call to the `addClinicalItemFeature` function of LabCultureMatrix.py.

#### Select biomarkers curated from domain experts
The next phase of this project could also benefit from further refining the list of features by curating other biomarkers
not related to medications. Further interviews with domain experts should be conducted to investigate biomarkers
such as Alanine aminotransferase (ALT) and Alkaline phosphatase (ALP).


# <a name="readings"></a>Suggested Readings
* https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5632149/
* https://www.sciencedirect.com/science/article/pii/S1532046418301291
* https://www.shmabstracts.com/abstract/predicting-bacteremia-in-hospitalized-patients-an-analysis-of-electronic-health-record-data/
* https://bmcmedinformdecismak.biomedcentral.com/articles/10.1186/s12911-017-0550-1
* https://www.sciencedirect.com/science/article/pii/S0924857907003445?via%3Dihub
* https://www.ncbi.nlm.nih.gov/pubmed/28268133
* https://academic.oup.com/cid/article/65/10/1607/3950071
* https://journals.lww.com/co-infectiousdiseases/Citation/2017/12000/Machine_learning___novel_bioinformatics_approaches.2.aspx
