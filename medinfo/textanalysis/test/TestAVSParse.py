#!/usr/bin/env python
"""Test case for respective module in application package"""

import sys, os
from io import StringIO
from datetime import datetime;
import unittest

from .Const import RUNNER_VERBOSITY;
from .Util import log;

from medinfo.db.test.Util import MedInfoTestCase;

from medinfo.db.Model import SQLQuery, RowItemModel;

from medinfo.textanalysis.AVSParse import AVSParse;

class TestAVSParse(MedInfoTestCase):
    def setUp(self):
        """Prepare state for test cases"""
        MedInfoTestCase.setUp(self);
        
        self.testFileStr = \
"""pat_mrn_id   pat_enc_csn_id  CONTACT_DATE    note_id avs_summary
100001               12345 01-JUL-14 500001
            This is your After Visit Summary    This contains your Discharge Instructions: Please show this to other physicians who provide your ongoing care.             XXXX  XXXXX   MRN: 100001       Hospital Encounter            Admitted: Admission Type:    1/2/2024 (Initial) Emergency           Summary of Hospitalization           About your hospitalization    You were admitted on:  July 2, 2024 You last received care in the:  B2    You were discharged on:  July 5, 2024 Unit phone number:  650-723-7101      Why you were hospitalized    Your primary diagnosis was:  Acute Chest Pain    Your diagnoses also included:  S/P Mvr (Mitral Valve Repair), Abdominal Pain      Providers seen during hospitalization    Provider Role    XXX, YYY, DO Attending Provider    GGGG, SSSS, MD Attending Provider      Referring provider for your hospitalization    Provider Primary office phone    Self-Referred Number not on file              Instruction for continuing your recovery at home           Discharge Instructional Orders and Information    Additional Instructions    Complete by:  As directed    Ms. XXXX,     You were admitted to the hospital, because you were having frequent abdominal and chest pain.  In the hospital, we determined that you did not have a heart attack. Your abdominal pain was likely caused by constipation, as it went away after you had three bowel movements. If you become constipated again, you can use Colace and Miralax, both are available at any pharmacy.    You kidney function was decreased when you first came to the emergency department; it improved slightly by the next day. We would like you to discuss this with Dr. XXXX, your primary care doctor, for long term management.    Please resume taking all your medications as you had been before coming to the hospital.     Return to the emergency department if you have severe, sustained chest pain.    Thank You,   SSSS SSSSSS, MD  p54321                    Medication Information              What to do with your medications      TAKE these medications       Common Name Instructions    AM Noon PM Bedtime    AEROCHAMBER Spcr   Generic drug:  Inhalational Spacing Device        1 Units by Misc.(Non-Drug; Combo Route) route as needed.                        albuterol 90 mcg/actuation HFA inhaler   Changes:  when to take this       PROVENTIL    2 Puffs by Inhalation route as needed.                        allopurinol 100 mg tablet   Changes:    - how much to take  - when to take this   Last time given:  7/3/2024  9:51 AM       ZYLOPRIM    take 1 Tab by mouth daily.                        Aspirin 81 mg Tbef        take 1 Tab by mouth Every Day.                        gabapentin 600 mg tablet   Changes:  how much to take   Last time given:  7/3/2024  3:50 AM       NEURONTIN    take 1 Tab by mouth 3 times a day.                        gemfibrozil 600 mg tablet   Changes:    - how much to take  - when to take this   Last time given:  7/3/2024  2:51 AM       LOPID    take 1 Tab by mouth 2 times a day.                        HYDROcodone-acetaminophen 5-325 mg tablet   Last time given:  7/3/2024  3:00 AM       NORCO    take 1 Tab by mouth every 6 hours as needed.                        lisinopril 10 mg tablet   Last time given:  7/3/2024  5:51 AM       PRINIVIL, ZESTRIL    take 1 Tab by mouth daily.                        omeprazole 20 mg delayed release capsule   Changes:    - how much to take  - when to take this       PRILOSEC    take 40 mg by mouth daily.                        zolpidem 5 mg tablet   Last time given:  7/3/2024 12:11 AM       AMBIEN    take 1 Tab by mouth every bedtime.                                  These are your currently scheduled appointments    Jul 19, 2024  3:00 PM   Return Extended Visit with LLLL, JJJJJ, MD   STANFORD INTERNAL MEDICINE EAST (SMG)    211 Quarry Road, 3rd Floor   Stanford CA 94305   (650) 498-9000         These appointments need to be scheduled (Call the number listed below to schedule appointment)    Follow Up (Stanford or UHA)    Complete by:  As directed    Please follow up with Dr. LLLL at the SIM clinic on July 19 at 3:00             Immunization History Reviewed on 7/2/2023    Flu Vaccine &gt;3 YO 9/30/2023, 10/8/2022, 9/11/2021, 11/11/2020, 11/23/2029    Flu Vaccine &gt;3 YO (Preservative Free) 1/13/2021    Hepatitis B Vaccine Adult 1/8/2022, 6/14/2022, 5/14/2022    INFLUENZA A H1N1 1/8/2020    PPD 5/10/2023    Pneumococcal Polyvalent Vaccine 10/1/2027      You are allergic to the following    Red Blood Cell Antibody    Acyclovir    Hydromorphone    Sulfa (Sulfonamide Antibiotics)      Discharge Instructions    None         Please present this summary of care to other physicians who provide your ongoing care.    For Your Physician:   Referring physicians can access information about the care provided to their patients at Stanford Hospital and Clinics using a secure, web-based portal called PRISM. Visit http://prism.stanfordmedicine.org for more details and to apply for a user account.

100002               23456 05-AUG-14 500002
            This is your After Visit Summary    This contains your Discharge Instructions: Please show this to other physicians who provide your ongoing care.             DDDDD PPPP.   MRN: 100002       Hospital Encounter            Admitted: Admission Type:    7/2/2014 (Initial) Emergency           Summary of Hospitalization           About your hospitalization    You were admitted on:  July 2, 2024 You last received care in the:  B1    You were discharged on:  July 3, 2024 Unit phone number:  650-724-0690      Why you were hospitalized    Your primary diagnosis was:  Not on File    Your diagnoses also included:  Angioedema      Providers seen during hospitalization    Provider Role    LLL, CCCC, MD Attending Provider    SSS, ZZZ, MD Attending Provider    LLL, CCCC, MD Attending Provider      Referring provider for your hospitalization    Provider Primary office phone    Self-Referred Number not on file              Instruction for continuing your recovery at home           Discharge Instructional Orders and Information    Additional Instructions    Complete by:  As directed    Dear Mr. Price,    You were admitted for swelling of the lips (angioedema). This was likely due to the blood pressure medication lisinopril. However, you recently also started taking the medication hydrochlorothiazide (a sulfa medication) so it&apos;s possible that you have a sulfa allergy. Do not take lisinopril or hydrochlorothiazide.     1) Do not take lisinopril or hydrochlorothiazide  2) Continue to take amlodipine (also known as norvasc)  3) See your primary medical doctor (Dr. JJJJ) to discuss alternative medications you can take for your blood pressure.  4) You may have increased risk of pancreatic cancer given your family history of pancreatic cancer. Please see a Stanford gastroenterologist for follow-up (a referral has been placed). You will need either endoscopic  ultrasounds OR MRI imaging done every 6 months for monitoring given your increased risk.     Warning Signs:  Fever, chills, chest pain, shortness of breath, increased lip swelling, any tongue swelling, or any other new or  worsening symptoms. Call your primary care doctor should you develop  these symptoms. If the symptoms are severe, then go to the nearest  emergency room.    You should be contacted for an appointment. If you do not  hear from anyone within the next 3 days, then contact the discharge  coordinator, CCC, at 650-725-6879 to verify your follow-up  appointment.    If you have any questions related to your discharge or medications,  please call 650-723-2300 and ask them to page Team D at pager 22222.  The members of team D include TTT GGG, KKK PPP, CCC LLL (Attending). We will be able to return your call if you reach us  this way.       Physical Activity    Complete by:  As directed    Physicial Activity:  As Tolerated             Your Diet Orders    Discharge Diet    As directed    Diet:  Regular Diet                    Medication Information              What to do with your medications      TAKE these medications       Common Name Instructions    AM Noon PM Bedtime    amLODIPine 5 mg tablet   Last time given:  7/3/2024  8:34 AM       NORVASC    take 1 Tab by mouth daily.                        pantoprazole 40 mg delayed release tablet   Last time given:  7/5/2024  8:54 AM       PROTONIX    take 1 Tab by mouth daily.                          STOP TAKING these medications    lisinopril 10 mg tablet   Commonly known as:  PRINIVIL, ZESTRIL                 These appointments need to be scheduled (Call the number listed below to schedule appointment)     Follow Up (Stanford or UHA)    Complete by:  As directed    Physician: Dr. JJJ Clinic: Primary Care  Time Frame: within the next 1 week  Number to Call: 650-498-XXXX             These referrals need to be scheduled (You will receive a phone call from the clinic to schedule)    Referral to Gastroenterology    Complete by:  As directed          Immunization History Reviewed on 3/31/2023    Flu Vaccine &gt;3 YO 1/4/2021    Flu Vaccine &gt;3 YO (Preservative Free) Deferred(Patient Refused)    Hepatitis B Vaccine 4/2/2023    TDAP Vaccine &gt;7 YO IM 10/25/2026      You are allergic to the following    No active allergies      Discharge Instructions    None         Please present this summary of care to other physicians who provide your ongoing care.    For Your Physician:   Referring physicians can access information about the care provided to their patients at Stanford Hospital and Clinics using a secure, web-based portal called PRISM. Visit http://prism.stanfordmedicine.org for more details and to apply for a user account.

100003               34567 03-SEP-13 500003
            This is your After Visit Summary    This contains your Discharge Instructions: Please show this to other physicians who provide your ongoing care.             SSSS FFFF Md   MRN: 100003       Hospital Encounter            Admitted: Admission Type:    3/3/2034 (Initial) Elective           Summary of Hospitalization           About your hospitalization    You were admitted on:  July 3, 2034 You last received care in the:  E2    You were discharged on:  July 6, 2034 Unit phone number:  650-725-7113      Why you were hospitalized    Your primary diagnosis was:  Not on File    Your diagnoses also included:  Occlusion And Stenosis Of Carotid Artery Without Mention Of Cerebral Infarction, Low Grade Myelodysplastic Syndrome Lesions, Hyperlipidemia, Hypertension, Urinary Retention, Dysphagia      Providers seen during hospitalization    Provider Role    SSS, GGG K, MD Attending Provider      Referring provider for your hospitalization    Provider Primary office phone    JJJ, MMM B, MD 650-325-9906      Surgery Information    ID Date/Time Status Primary Surgeon Primary Procedure Location          100003 7/5/2024 0652 Posted SSSS, GGGG K, MD LEFT CAROTID ENDARTERECTOMY WITH INTRAOPERATIVE MONITORING STANFORD HOSPITAL MAIN OR             Instruction for continuing your recovery at home           Discharge Instructional Orders and Information    Discharge Wound Care    Complete by:  As directed    Bandage can be removed from incisions 48 hours after surgery.  Keep incisions clean, dry and open to air.  Wear loose fitting clothing when able.  May place bandage over incision if it is being irritated by clothing (change bandage daily), but it is not necessary.  Do not pick, scratch or scrub the incisions. Do not apply any kind of lotions or chemical solutions to the incisions.  If an incision is itching, you may sparingly apply topical antibiotic ointment around the outside of the  incision to soothe it.  No water exposure to incisions until sutures or staples are removed. Light showers are allowed, but prolonged water exposure is not recommended for 7 days (bathing, swimming);  can consider covering wound with saran wrap during showers.  Sutures or staples need to be removed in 7-10 days       Notify MD    Complete by:  As directed    Warning signs:    If you develop symptoms listed below, please seek medical attention:    - new weakness, numbness, or loss of bowel/bladder control   - severe headache  - new seizure  - severe nausea/vomiting  - fever &gt; 101.5  - headache with neck stiffness and fatigue  - increasing redness around or discharge from incisions     If your symptoms are concerning, but you are not sure if you should come to the hospital, you may call the neuroscience clinic at 650-723-6469. After hours, you may call 650-723-6661 and ask to speak with the neurosurgery resident on call.     If your symptoms are more severe, you are concerned you may be having a stroke, or if you have chest pain or difficulty breathing, please call 911 or go to the emergency room.             Your Diet Orders    Discharge Diet    As directed    Diet:  Regular Diet                    Medication Information              What to do with your medications      TAKE these medications       Common Name Instructions    AM Noon PM Bedtime    albuterol 90 mcg/actuation HFA inhaler   Last time given:  6/2/2024  9:03 AM       PROVENTIL    by Inhalation route every 6 hours as needed.                        aspirin 81 mg enteric coated tablet   Last time given:  6/6/2024 12:55 PM        take 1 Tab by mouth every morning with breakfast.                        ATIVAN PO        take 0.5 mg by mouth as needed.                        CIALIS 2.5 mg Tabs   Generic drug:  Tadalafil        take 2.5 mg by mouth as needed.                        dexamethasone 1 mg tablet       DECADRON    1 mg tabs: Take 4 tabs q6 hr  x 1 day, 4q8 x 1d, 3q8 x 1d, 2x8 x 1d, 1q8 x 1d, 1q12 x 1d, 1 daily x 1d, stop                        DIOVAN 80 mg tablet   Last time given:  7/7/2024  9:00 AM   Generic drug:  valsartan        take 80 mg by mouth 2 times a day.                        docusate 250 mg capsule   Last time given:  3/7/2034  9:00 AM       COLACE    take 1 Cap by mouth 2 times a day.                        famotidine 20 mg tablet   Last time given:  7/4/2024 10:00 PM       PEPCID    take 1 Tab by mouth 2 times a day.                        felodipine 10 mg tablet   Last time given:  7/9/2024  9:00 AM       PLENDIL    take 10 mg by mouth daily.                        FLOMAX 0.4 mg capsule   Last time given:  7/9/2024  9:00 AM   Generic drug:  tamsulosin        take 0.4 mg by mouth daily.                        fluticasone 220 mcg/actuation inhaler       FLOVENT    2-4 Puffs by Inhalation route 2 times a day. Rinse and gargle after each use.                        folic acid 1 mg tablet   Last time given:  7/1/2034  9:00 AM       FOLVITE    take 1 mg by mouth daily.                        HYDROcodone-acetaminophen 5-325 mg tablet   Last time given:  7/11/2024 10:33 PM       NORCO    take 1-2 Tabs by mouth every 4 hours as needed.                        LIPITOR 10 mg tablet   Last time given:  7/13/2034  9:00 AM   Generic drug:  atorvastatin        take 10 mg by mouth daily.                        polyethylene glycol 17 gram packet       MIRAlax    take 1 Packet by mouth daily as needed.                        senna tablet   Last time given:  5/3/2034  9:00 AM       SENOKOT    take 1 Tab by mouth 2 times a day.                        zolpidem 10 mg tablet       AMBIEN    take 10 mg by mouth every bedtime as needed. ~3 times per week                          STOP TAKING these medications    azithromycin 250 mg tablet   Commonly known as:  ZITHROMAX         Where to Get Your Medications     You need to pick up these prescriptions. We sent them to a specific pharmacy, so go there to get them.    MEDICAL PLAZA PHARMACY - 211 QUARRY ROAD - PALO ALTO, CA   -  aspirin 81 mg enteric coated tablet   -  dexamethasone 1 mg tablet   -  docusate 250 mg capsule   -  famotidine 20 mg tablet   -  HYDROcodone-acetaminophen 5-325 mg tablet   -  polyethylene glycol 17 gram packet   -  senna tablet    211 QUARRY ROAD SUITE 108 Phone:  650-326-2300   PALO ALTO CA 94304                           These are your currently scheduled appointments    Feb 25, 2025 11:30 AM   Return Patient Visit with VVV, RRR H, MD   Cardiovascular Med (--)    300 Pasteur Drive  Stanford, A260  Stanford CA 94305   650-723-6459         These appointments need to be scheduled (Call the number listed below to schedule appointment)    Follow Up (Stanford or UHA)    Complete by:  As directed    Department: Neurosurgery, Dr. SSS, Date/time: Call our office to make an appointment. Phone number to call regarding appointment 650-723-6469.  Department: ENT, Dr. KKK, followup in 2-3 weeks from discharge             Immunization History Reviewed on 7/2/2024    Flu Vaccine &gt;3 YO 10/10/2031    Pneumococcal Polyvalent Vaccine 1/3/2039      You are allergic to the following    Adhesive Tape    Sulfa (Sulfonamide Antibiotics)    Trimethoprim      Discharge Instructions      Aspiration Pneumonia     Aspiration pneumonia is an infection in your lungs. It occurs when you breathe (aspirate) things into your lungs such as food, vomit or liquid. When these things get into your lungs, swelling (inflammation) can occur. This can make it difficult for you to breath. Aspiration pneumonia is a serious condition and can be life threatening.      CAUSES   Aspiration pneumonia can have many causes. Some of the causes include:  ? Having a brain injury or disease:  l Stroke.  l Seizures.  l Confusion (Dementia).   l ALS (Amyotrophic Lateral Sclerosis, or Lou Gehrig&apos;s disease).  l Parkinson&apos;s disease.  ? Other causes of aspiration pneumonia:  l Being under general anesthesia.  l Being in a coma (unconscious). This unconscious state can be caused by drugs, injury or disease. Being in a coma can decrease a person&apos;s gag reflex, which can make it easier for aspiration to occur.   l A narrowing of the esophagus (the tube that carries food to the stomach).  l Having dental problems that make it hard to swallow.  l Drinking too much alcohol. If a person passes out and vomits, vomit can be swallowed into the lungs.  l Taking certain medications. Tranquilizers and sedatives can sometimes decrease your swallowing or gag reflex.     SYMPTOMS   ? Coughing after swallowing food or liquids.   ? Breathing problems. These could include wheezing (a whistling sound) or shortness of breath.   ? Bluish skin. This can be caused by lack of oxygen.   ? Fever.   ? Chest pain.  ? Coughing up food or mucus. The mucus might contain blood, pus or greenish material.  ? Fatigue (being more tired than usual).  ? Sweating more than usual.  ? Bad breath.     DIAGNOSIS   A physical examination and testing will be needed to see if aspiration pneumonia is present. This can include:  ? A review of the above symptoms.  ? Chest X-ray. This gives a picture of the lungs.  ? Listening through a stethoscope. The healthcare provider will listen for:  l Crackling sounds in the lungs.  l Decreased breath sounds.  l A rapid heartbeat.  ? Swallowing study. This test looks at how food is swallowed and whether it goes into your breathing tube (trachea) or food pipe (esophagus).   ? Sputum culture. Sputum (saliva and mucus) is collected from the lungs or bronchi (tubes that carry air to the lungs). It is then tested for bacteria.  ? Computed tomography. This is called a CT scan. It also can show lung damage.   ? Bronchoscopy. This test uses a flexible tube (a bronchoscope) to see inside the lungs.      TREATMENT  Treatment will depend on how severe the aspiration pneumonia is and what led to it.  ? Some people may need to be treated in the hospital. Your breathing will be carefully monitored. Depending on how well you are breathing, you may:  l Be able to breath on your own but need oxygen.  l Need breathing support via a breathing machine. (ventilator).   ? Medication:  l Antibiotics or anti-fungal drugs might be prescribed. The particular medicine will depend on what caused the infection.  l Other drugs may be given to reduce fever and/or pain.  ? Other treatments or corrections may be needed. For example:  l Following a recommended diet. This is especially important if the swallowing study was failed.   l Revising medications.  l Fixing dental problems.  l Correcting breathing obstructions.  l Treating stomach disorders.  l Dealing with alcohol issues.  l Having a feeding tube placed in the stomach.      HOME CARE INSTRUCTIONS   ? Take any medicines that were prescribed. Follow the directions carefully.  ? Check with your caregiver before taking over-the-counter medications.  ? Rest as instructed by your caregiver.  ? Keep all follow-up appointments with your healthcare provider. This is important so the caregiver can make sure the pneumonia is gone.     SEEK MEDICAL CARE IF:  Any of these symptoms return:  ? Shortness of breath or difficulty breathing.  ? Wheezing.  ? Fever of more than 100.5 F (38.1 C) or as recommended by your caregiver.  ? Chest pain.     MAKE SURE YOU:   ? Understand these instructions.   ? Will watch your condition.  ? Will get help right away if you are not doing well or get worse.     Document Released: 10/15/2010  Document Re-Released: 12/06/2010  ExitCare? Patient Information ?2011 ExitCare, LLC.  Dysphagia (Swallowing Problems)      Swallowing problems occur when solids and liquids seem to stick in your throat on the way down to your stomach, or the food takes longer to get to the stomach. Other symptoms (problems) include regurgitating (burping) up food, noises coming from the throat, chest discomfort with swallowing, and a feeling of fullness in the throat when swallowing. When blockage in the throat is complete it may be associated with drooling.     CAUSES OF DYSPHAGIA (SWALLOWING PROBLEMS)  There are many causes of swallowing difficulties and the following is generalized information regarding a number of reasons for this problem. Problems with swallowing may occur because of problems with the muscles. The food cannot be propelled in the usual manner into the stomach. There may be ulcers, scar tissue or inflammation (soreness) in the esophagus (the food tube from the mouth to the stomach) which blocks food from passing normally into the stomach. Causes of inflammation include acid reflux from the stomach into the esophagus. Inflammation can also be caused by the herpes simplex virus, Candida (yeast), radiation (as with treatment of cancer), or inflammation from medications not taken with adequate fluids to wash them down into the stomach. There may be nerve problems so signals cannot be sent adequately telling the muscles of the esophagus to contract and move the food along. Achalasia is a rare disorder of the esophagus in which muscular contractions of the esophagus are uncoordinated. Globus hystericus is a relatively common problem in young females in which there is a sense of an obstruction or difficulty in swallowing, but in which no abnormalities can be found. This problem usually improves over time with reassurance and testing to rule out other causes.     EVALUATION (DIAGNOSIS) OF SWALLOWING PROBLEMS  A number of tests will help your caregiver know what is the cause of your  swallowing problems. These tests may include a barium swallow in which x-rays are taken while you are drinking a liquid that outlines the lining of the esophagus on x-ray. If the stomach and small bowel are also studied in this manner it is called an upper gastrointestinal exam (UGI). Endoscopy may be done in which your caregiver examines your throat, esophagus, stomach and small bowel with an instrument like a small flexible telescope. Motility studies which measure the effectiveness and coordination of the muscular contractions of the esophagus may also be done.     TREATMENT AND ITS IMPORTANCE  The treatment of swallowing problems are many, varying from medications to surgical treatment. The treatment varies with the type of problem found. Your caregiver will discuss your results and treatment with you. If swallowing problems are severe the long term problems which may occur include: malnutrition, pneumonia (from food going into the breathing tubes called trachea and bronchi), and an increase in tumors (lumps) of the esophagus.     SEEK IMMEDIATE MEDICAL ATTENTION IF:  ? Food or other object becomes lodged in your throat or esophagus and won?t move.     Document Released: 12/15/2001  Document Re-Released: 01/29/2008  ExitCare? Patient Information ?2011 ExitCare, LLC.    Patient Care Services  300 Pasteur Drive  Stanford, CA 94305      The Patient was given access to the following documents on Jul 3, 2034   CAROTID ENDARTERECTOMY - Discharge Care, English (SaveNote version)                 Patient Care Services  300 Pasteur Drive  Stanford, CA 94305  CAROTID ENDARTERECTOMY  WHAT YOU SHOULD KNOW:  A carotid endarterectomy (en-dar-ter-ek-tuh-mee) is surgery to remove plaque (fat) from inside your carotid artery. The carotid artery is a blood vessel found in both sides of your neck. Surgery will clean the carotid artery so blood can flow to your brain better. You will have an  incision on the side of your neck after surgery. The stitches that close the incision are under the skin and will dissolve.        AFTER YOU LEAVE:  Your medicines are:           .   Keep a written list of what medicines you take and when and why you take them. Bring the list of your medicines or the pill bottles when you see your caregivers. Ask your caregiver for information about your medicines. Do not take any medicines, over-the-counter drugs, vitamins, herbs, or food supplements without first talking to caregivers. Your caregivers can find out if these medicines interact with other medicines that you are taking.    Always take your medicine as directed by caregivers. Call your caregiver if you think your medicines ar    e not helping or if you feel you are having side effects. Do not quit taking it until you discuss it with your caregiver. If you are taking antibiotics (an-ti-bi-ah-tiks), take them until they are all gone even if you feel better. You should take antibiotics before and after dental work.    If you are taking medicine that makes you drowsy, such as pain medicine, do not drive or use heavy equipment.    Your caregiver may prescribe blood thinners, such as aspirin or other antiplatelet medications, to take after you are discharged from the hospital. This is to replace the blood thinning medicine you may have been receiving in your IV in the hopsital. This medicine helps to stop blood from forming clots.    Blood pressure medicine may be needed to lower your blood pressure after your surgery. You may have to take it for the rest of your life. You will need to ask your primary care physican if you need to continue the blood pressure medication or any other new medications after you leave the hospital.    You should resume taking all of the medications that you were taking at home, prior to coming into the hospital for surgery, unless you are told otherwise by your Vascular Surgeon.   Appointment: You have a follow-up appointment scheduled on           at           with           .   Write down questions you have about having a carotid endarterectomy. This way you&apos;ll remember to ask these questions during your next visit.  You will need to make an appointment to see your primary doctor one week after discharge from the hospital. Your doctor should review with you all of the medications you are taking and decide if any changes need to be made to those medications.  Numbness: It is normal for the area around your incision and the side of your face around your jawline to be numb after surgery. This should go away in less than a year. The earlobe on the same side as surgery may feel numb. This may only last a short time or it may last forever.  Bathing: You may shower 72 hours (3 days) after your surgery. You should not soak in a bathtub, hot tub, or swimming pool until your incision is well healed.  Incision Care: Carefully wash the incision with soap and water and pat dry. You may have steri-strips (thin strips of tape) on your incision. As they start to peel off, let them fall off by themselves. Do not pull them off. Do not use lotions, creams, or powder on the incision.  Dental Prophylaxis: If a man-made (synthetic) patch is used to close your carotid artery during surgery, you will require antibiotics prior to all dental procedures, including teeth cleaning, for the rest of your life. You should not have any dental cleaning or elective dental care for at least 90 days after your surgery. Notify your dentist prior to your dental appointment that you have a patch (of synthetic graft) on your carotid artery. You will also require antibiotics prior to any invasive procedure or surgery in the future. Any health care provider who is involved in your care should be made aware of this recommendation.  BM: It may be hard for you to have a bowel movement (BM) after the  procedure. Don&apos;t try to push the BM out if it&apos;s too hard. Walking is the best way to get your bowels moving. Eat foods high in fiber to make it easier to have a BM. Good examples are high fiber cereals, beans, vegetables, and whole grain breads. Prune juice may help make the BM softer. You will be given a prescription for a stool softener that you should take for a couple of weeks, twice a day unless you have diarrhea. Drinking fluids and keeping yourself well hydrated, increasing your activity level, and eating fruit regularly will also help.  Rest and Activity:  You may feel like resting more after surgery. Slowly start to do more each day. Rest when you feel it is needed.    Walking is the best exercise to start first. Take short walks several times a day, gradually increasing the distance and time that you walk. In the first two weeks after surgery, avoid power walking and physically over-exerting yourself. Ask your doctor when you can resume all of your normal activites.    Talk to your caregiver before you start exercising. Together you can plan the best exercise program for you. It is best to start slowly and do more as you get stronger. Exercising makes the heart stronger, lowers blood pressure, and keeps you healthy. During the first 3 months after surgery, do not bend a lot or play contact sports like football.    Avoid straining or bending over with your head down.    Avoid heavy housework or yard work for 30 days.    Do not lift anything heavier than 5 pounds for 3 weeks.    You may drive in 2 weeks. You need to have full range of motion of your neck so that you can see over each shoulder when you turn your head before you can drive.    You may return to work when your doctor tells you that it is okay.    You may have sex when you feel ready. Remember that this can be strenuous activity. Stop if it causes pain. Talk to your caregiver if you have questions or concerns.  Wellness Hints:    Eat healthy foods from all of the 5 food groups: fruits, vegetables, breads, dairy products, meat and fish. Eating healthy foods may help you feel better and have more energy. It may also help you heal faster.     Your diet will not be restricted after your carotid surgery unless your primary care physician recommends this. Please check with your primary care physician about your diet restrictions.    You may be told to eat foods that are low in fat. It is important to control your cholesterol level and prevent future plaques from forming. Ask for the CareNotes  handout about low fat diets for more information.    You may also be told to limit the amount of salt you eat. This may mean you should not add salt to your food during meals or when you cook. Ask for the CareNotes  handout about low salt diets for more information.    It can take time getting used to a new diet. Special cook books may help the cook in the family find new recipes.  A healthy diet is important for your incision to heal well.  Drink 6 to 8 (8-ounce) glasses of liquid each day. Or, follow your caregiver&apos;s advice if you must limit the amount of liquid you drink. Good liquids to drink are water, juices, and milk. Limit the amount of caffeine you drink, such as coffee, tea, and soda. It is best to drink decaffeinated beverages as the caffeine can dehydrate you.    Stress may slow healing and cause illness later. Since it is hard to avoid stress, learn to control it. Learn new ways to relax (deep breathing, relaxing muscles, meditation, or biofeedback). Talk to your caregiver about things that upset you.    CALL THE VASCULAR SURGERY CLINIC AT (650) 725-5227 IF:  You get a temperature over 101 F (38.3 C) or you have chills.    Your incision comes apart, or there is a steady stream of blood coming from the incision.    Your incision is swollen, red, or has pus coming from it. This may mean you have an infection.    You have a severe headache.     Your skin is itchy, swollen, or has a rash. Your medicine may be causing these symptoms. This may mean you are allergic (uh-ler-jik) to your medicine.    You have questions or concerns about your surgery or medicine.  SEEK CARE IMMEDIATELY BY CALLING 911 IF:  You have uncontrolled bleeding from your incision.    You have trouble breathing all of a sudden. This could be a sign that you have a blood clot in your lung. It could also mean that you are allergic to a medicine you are taking.    You have signs or symptoms of stroke such as slurred speech or you are unable to speak, you cannot move part of your body, you become dizzy, confused, you have blurred vision, or cannot see out of one or both eyes. This is an emergency. Call 911 or 0 (operator) to get to the nearest hospital or clinic. Do not drive yourself!    You have chest pain that spreads to your arms, jaw, or back. Or, if you are sweating, sick to your stomach (nauseated), and are having trouble breathing. These are signs of a heart attack. This is an emergency. Call 911 or 0 (operator) to get to the nearest hospital or clinic. Do not drive yourself!  Modified: Vascular Clinic 10/05      ? 2014 Truven Health Analytics Inc. This patient education document was created using the MICROMEDEX(R) System and may contain MICROMEDEX proprietary information. All illustrations and images included in CareNotes? are the copyrighted property of A.D.A.M., Inc. or Truven Health Analytics.   CAROTID ENDARTERECTOMY - Discharge Care, English (SaveNote version)   Generated on Thursday, July 3, 2014 1:23:31 PM           Please present this summary of care to other physicians who provide your ongoing care.    For Your Physician:   Referring physicians can access information about the care provided to their patients at Stanford Hospital and Clinics using a secure, web-based portal called PRISM. Visit http://prism.stanfordmedicine.org for more  details and to apply for a user account.                     Anesthesia Information    If you note problems or have concerns about your recovery from anesthesia, please call the Department of Anesthesiology, Perioperative and Pain Medicine at 650.723.6411.
""";
        
        self.parser = AVSParse();  # Instance to test on

    def tearDown(self):
        """Restore state from any setUp or test steps"""
        MedInfoTestCase.tearDown(self);

    def test_documentParse(self):
        # Run the data conversion on the test data and look for expected answers
        headers = ["note_id","pat_mrn_id","contact_date","FollowupPhone","TeamPager","DietOrders","PrimaryDx","FollowupSchedule","NewRx","StopRx","AddnInstr"];
        expectedDataTable = \
            [
                ["500001", "100001", "01-JUL-14", 1, 1, 0, 1, 1, 0, 0, 7],
                ["500002", "100002", "05-AUG-14", 0, 1, 3, 0, 0, 0, 1, 7],
                ["500003", "100003", "03-SEP-13", 3, 0, 3, 0, 1, 6, 1, 54],
            ];
        expectedData = list();
        for row in expectedDataTable:
            expectedData.append( RowItemModel(row, headers) );
        
        sourceFile = StringIO(self.testFileStr);
        outputFile = StringIO();  # Save but discard this, won't inspect detailed contents
        actualData = self.parser(sourceFile, outputFile);
        """
        for summaryRecord in actualData:
            for header in headers:
                print >> sys.stderr, summaryRecord[header],
            print >> sys.stderr;
            print >> sys.stderr, summaryRecord["docModel"]["StopRx"]
        """
        self.assertEqualDictList( expectedData, actualData, headers );


def suite():
    """Returns the suite of tests to run for this test class / module.
    Use unittest.makeSuite methods which simply extracts all of the
    methods for the given class whose name starts with "test"
    """
    suite = unittest.TestSuite();
    #suite.addTest(TestAVSParse('test_dataConversion_maxMixtureCount'));
    suite.addTest(unittest.makeSuite(TestAVSParse));
    
    return suite;
    
if __name__=="__main__":
    unittest.TextTestRunner(verbosity=RUNNER_VERBOSITY).run(suite())
